<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>pmapreduce · ParallelUtilities.jl</title><link rel="canonical" href="https://jishnub.github.io/ParallelUtilities.jl/examples/pmapreduce/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">ParallelUtilities.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">ParallelUtilities</a></li><li><a class="tocitem" href="../../pmapreduce/">Mapreduce</a></li><li><span class="tocitem">Examples</span><ul><li class="is-active"><a class="tocitem" href>pmapreduce</a></li><li><a class="tocitem" href="../sharedarrays/">SharedArrays</a></li><li><a class="tocitem" href="../threads/">Threads</a></li></ul></li><li><a class="tocitem" href="../../clusterquery/">ClusterQueryUtils</a></li><li><a class="tocitem" href="../../api/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>pmapreduce</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>pmapreduce</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jishnub/ParallelUtilities.jl/blob/master/docs/src/examples/pmapreduce.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-of-the-use-of-pmapreduce"><a class="docs-heading-anchor" href="#Example-of-the-use-of-pmapreduce">Example of the use of pmapreduce</a><a id="Example-of-the-use-of-pmapreduce-1"></a><a class="docs-heading-anchor-permalink" href="#Example-of-the-use-of-pmapreduce" title="Permalink"></a></h1><p>The function <code>pmapreduce</code> performs a parallel <code>mapreduce</code>. This is primarily useful when the function has to perform an expensive calculation, that is the evaluation time per core exceeds the setup and communication time. This is also useful when each core is allocated memory and has to work with arrays that won&#39;t fit into memory collectively, as is often the case on a cluster.</p><p>We walk through an example where we initialize and concatenate arrays in serial and in parallel.</p><p>We load the necessary modules first</p><pre><code class="language-julia">using ParallelUtilities
using Distributed</code></pre><p>We define the function that performs the initialization on each core. This step is embarassingly parallel as no communication happens between workers. We simulate an expensive calculation by adding a sleep interval for each index.</p><pre><code class="language-julia">function initialize(sleeptime)
    A = Array{Int}(undef, 20, 20)
    for ind in eachindex(A)
        sleep(sleeptime)
        A[ind] = ind
    end
    return A
end</code></pre><p>Next we define the function that calls <code>pmapreduce</code>:</p><pre><code class="language-julia">function main_pmapreduce(sleeptime)
    pmapreduce(x -&gt; initialize(sleeptime), hcat, 1:20)
end</code></pre><p>We also define a function that carries out a serial mapreduce:</p><pre><code class="language-julia">function main_mapreduce(sleeptime)
    mapreduce(x -&gt; initialize(sleeptime), hcat, 1:20)
end</code></pre><p>We compare the performance of the serial and parallel evaluations using 20 cores on one node:</p><pre><code class="language-julia">julia&gt; compare_with_serial()
Tesing serial
  9.457601 seconds (40.14 k allocations: 1.934 MiB)
Tesing parallel
  0.894611 seconds (23.16 k allocations: 1.355 MiB, 2.56% compilation time)
Results match : true</code></pre><p>The full script may be found in the examples directory.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../pmapreduce/">« Mapreduce</a><a class="docs-footer-nextpage" href="../sharedarrays/">SharedArrays »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Tuesday 6 April 2021 06:30">Tuesday 6 April 2021</span>. Using Julia version 1.6.0.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
